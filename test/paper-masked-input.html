<!doctype html>
<html>

<head>
  <title>paper-masked-input tests</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">

  <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
  <script src="../node_modules/@polymer/test-fixture/test-fixture.js"></script>
  <script src="../node_modules/mocha/mocha.js"></script>
  <script src="../node_modules/chai/chai.js"></script>
  <script src="../node_modules/wct-mocha/wct-mocha.js"></script>

</head>

<body>
  <test-fixture id="basic">
    <template>
      <paper-masked-input></paper-masked-input>
    </template>
  </test-fixture>
  <test-fixture id="visible">
    <template>
      <paper-masked-input visible></paper-masked-input>
    </template>
  </test-fixture>
  <test-fixture id="errorred">
    <template>
      <paper-masked-input auto-validate pattern="[0-9]*" value="foobar" error-message="error"></paper-masked-input>
    </template>
  </test-fixture>

  <test-fixture id="invalid">
    <template>
      <paper-masked-input auto-validate required></paper-masked-input>
    </template>
  </test-fixture>

  <script type="module">
  import '../paper-masked-input.js';
  // import { dom } from '../../../@polymer/polymer/lib/legacy/polymer.dom.js';
  // import { a11ySuite } from '../../../wct-browser-legacy/a11ySuite.js';
  suite('basic', () => {
    let input;
    setup(() => {
      input = fixture('basic');
    });

    test('Initial visibility state is off', () => {
      assert.equal(input.visible, false);
    });

    test('Setting visibility shows the password', () => {
      input.visible = true;
      assert.equal(input.inputElement.type, 'text');
    });

    test('setting value sets the input value', () => {
      input.value = 'foobar';
      assert.equal(input.inputElement.value, input.value);
    });

    test('clear the input value', () => {
      input.value = 'foobar';
      assert.equal(input.inputElement.value, input.value, 'inputElement.value equals input.value');
      input.clear();
      assert.equal(input.inputElement.value, '', 'inputElement.value equals ""');
    });

    test('Default visibility icon is `visibility`', () => {
      const button = input.shadowRoot.querySelector('#toggleButton');
      assert.equal(button.icon, 'arc:visibility');
    });

    test('Changing visibility icon changes', () => {
      const button = input.shadowRoot.querySelector('#toggleButton');
      input.visible = true;
      assert.equal(button.icon, 'arc:visibility-off');
    });

    // a11ySuite('basic');
  });

  suite('visible by default', () => {
    let input;
    setup(() => {
      input = fixture('visible');
    });

    test('Initial visibility state is on', () => {
      assert.equal(input.visible, true);
    });

    test('Default visibility icon is `visibility-off`', () => {
      const button = input.shadowRoot.querySelector('#toggleButton');
      assert.equal(button.icon, 'arc:visibility-off');
    });
  });

  suite('Validation', () => {
    test('validate() returns false', (done) => {
      const input = fixture('invalid');
      flush(() => {
        const result = input.validate();
        assert.isFalse(result);
        done();
      });
    });

    test('validate() returns true for valid input', (done) => {
      const input = fixture('invalid');
      flush(() => {
        input.value = 'test';
        const result = input.validate();
        assert.isTrue(result);
        done();
      });
    });

    // Data binding
    test('error message is displayed (data binding)', function(done) {
      const input = fixture('errorred');
      flush(() => {
        const error = input.inputElement.shadowRoot.querySelector('paper-input-error');
        assert.ok(error, 'paper-input-error exists');
        assert.notEqual(getComputedStyle(error).display, 'none', 'error is not display:none');
        done();
      });
    });
  });
  </script>
</body>

</html>
